<?php

namespace ZPB\AdminBundle\Entity;

use Doctrine\ORM\Query;


/**
 * PublishPostRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PublishPostRepository extends PostableRepository
{
    public function getPosts()
    {
        $qb = $this->_em->createQueryBuilder()
            ->addSelect("pub")
            ->addSelect("post")
            ->addSelect("category")
            ->from("ZPBAdminBundle:PublishPost ", "pub")
            ->leftJoin("pub.post", "post")
            ->leftJoin("pub.category", "category")
        ;
        return $qb->getQuery()->getArrayResult();
    }

    public function getOrderedPosts()
    {
        $qb = $this->_em->createQueryBuilder()
            ->addSelect("pub")
            ->addSelect("post")
            ->addSelect("category")
            ->from("ZPBAdminBundle:PublishPost ", "pub")
            ->leftJoin("pub.post", "post")
            ->leftJoin("pub.category", "category")
            ->orderBy("pub.updatedAt","ASC")
        ;
        return $qb->getQuery()->getArrayResult();
    }

    public function getPost($id)
    {
        $qb = $this->_em->createQueryBuilder()
            ->addSelect("pub")
            ->addSelect("post")
            ->addSelect("category")
            ->from("ZPBAdminBundle:PublishPost ", "pub")
            ->leftJoin("pub.post", "post")
            ->leftJoin("pub.category", "category")
        ;
        $qb->where($qb->expr()->eq("s.id", $id));
        return $qb->getQuery()->getOneOrNullResult(Query::HYDRATE_ARRAY);
    }

    public function getPostBySlug($slug)
    {
        $qb = $this->_em->createQueryBuilder()
            ->addSelect("pub")
            ->addSelect("post")
            ->addSelect("category")
            ->from("ZPBAdminBundle:PublishPost ", "pub")
            ->leftJoin("pub.post", "post")
            ->leftJoin("pub.category", "category")
        ;
        $qb->where("post.slug = :slug");
        $qb->setParameter("slug", $slug);
        return $qb->getQuery()->getOneOrNullResult(Query::HYDRATE_ARRAY);
    }

    public function getPostsByCategory($slug)
    {
        $qb = $this->_em->createQueryBuilder()
            ->addSelect("pub")
            ->addSelect("post")
            ->addSelect("category")
            ->from("ZPBAdminBundle:PublishPost ", "pub")
            ->leftJoin("pub.post", "post")
            ->leftJoin("pub.category", "category")
        ;
        $qb->where("category.slug = :slug");
        $qb->setParameter("slug", $slug);
        return $qb->getQuery()->getOneOrNullResult(Query::HYDRATE_ARRAY);
    }
}
