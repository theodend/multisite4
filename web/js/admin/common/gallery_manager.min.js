var GalleryManager=function(){function a(b,c,d){this.$element=b,this.imgs=c,this.options={},this.options=$.extend(!0,{},a.DEFAULTS,d||{}),this.initEvents()}return a.prototype.addImg=function(a){var b;this.imgs.push(a),b=this.createRow(a),this.$element.append(b)},a.prototype.createRow=function(a){var b=this.options.rowTmpl;return b=b.replace("[[webRoot]]",a.webRoot).replace("[[position]]",a.position+"").replace(/\[\[id\]\]/g,a.id),b=null!=a.title?b.replace("[[title]]",a.title):b.replace("[[title]]",""),$(b)},a.prototype.getImgById=function(a){var b=null;return $.each(this.imgs,function(c,d){d.id==a&&(b=d)}),b},a.prototype.getImageIndex=function(a){var b=null;return $.each(this.imgs,function(c,d){d.id==a&&(b=c)}),b},a.prototype.removeImage=function(a,b){var c,d,e,f=this;c=this.getImgById(b),null!=c&&(d=this.getImageIndex(b),e=a.next(".loader"),a.hide(),e.show(),$.ajax({type:"DELETE",url:this.options.deleteImgUrl,data:{id:b}}).done(function(c){if(0==c.error){var g=f.options.rowPrefix+b;$("#"+g).remove(),f.imgs.splice(d,1),f.options.showMsg(c.msg,!0)}else a.show(),e.hide(),f.options.showMsg(c.msg,!1)}).fail(function(b){a.show(),e.hide(),f.options.showMsg(b.statusCode+" "+b.statusText,!1)}))},a.prototype.changeActiveState=function(a){var b,c,d,e=this;b=this.$element.find("#"+this.options.rowPrefix+a),console.log(b),b.length>0&&(d=b.find("button.delete-img-btn"),c=d.next(".loader"),d.hide(),c.show(),e.options.showMsg(),$.ajax({type:"PUT",url:this.options.changeActiveStateUrl,data:{id:a}}).done(function(a){0==a.error?(b.isActive=!b.isActive,e.options.showMsg(a.msg,!0)):e.options.showMsg(a.msg,!1),d.show(),c.hide()}).fail(function(a){d.show(),c.hide(),e.options.showMsg(a.statusCode+" "+a.statusText,!1)}))},a.prototype.confirm=function(a){return window.confirm(a)},a.prototype.initEvents=function(){var a=this;$(document).on("click","button.delete-img-btn",function(b){return b.preventDefault(),a.confirm(a.options.deleteMessage)&&a.removeImage($(this),$(this).data("img")),!1}),$(document).on("change","[data-activation='']",function(b){b.preventDefault();var c=parseInt($(this).attr("id").replace(a.options.checkboxIdPrefix,""));a.changeActiveState(c,$(this))})},a.DEFAULTS={updateUrl:"",deleteMessage:"Attention! cette action est irr√©versible. Vous confirmez la suppression ?",deleteImgUrl:"",rowPrefix:"img_",checkboxIdPrefix:"active_img_",showMsg:function(){},rowTmpl:'<div class=\'image\' id=\'img_[[id]]\'><table><tr><td class="img-handle"></td><td class="img-position">[[position]]</td> <td class="img-img"><img src="[[webRoot]]" alt=""/></td><td class="img-activation"><label for="active_img_[[id]]"><input type="checkbox" id="active_img_[[id]]" data-activation=\'\'/> Activer</label></td><td class="img-title"><input type="text" value=\'[[title]]\'/></td><td class="img-delete"><button type="button" class="btn btn-default delete-img-btn" data-img=\'[[id]]\'><i class="fa fa-trash-o"></i></button></td></tr></table></div>'},a}();