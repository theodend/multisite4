var ImageUpload=function(){function a(b,c){this.element=b,this.options={},this.options=$.extend(!0,{},a.DEFAULTS,c||{}),this.$element=$(this.element),this.$element.data("uploader",this),this.isDroppable=!0,this.initEvents()}return a.prototype.onDragEnter=function(a){a.preventDefault()},a.prototype.onDragOver=function(a){a.preventDefault();var b=$(this).data("uploader");$(this).addClass(b.options.hoverClass)},a.prototype.onDragLeave=function(a){a.preventDefault();var b=$(this).data("uploader");$(this).removeClass(b.options.hoverClass)},a.prototype.onDrop=function(a){a.preventDefault();var b=$(this).data("uploader");$(this).removeClass(b.options.hoverClass),b.isDroppable&&(b.options.onDropped(b),b.isDroppable=!1,b.upload(a.dataTransfer.files))},a.prototype.upload=function(a){var b=a[0],c=this,d=null;return"size"in b?b.size>this.options.fileMaxSize?(c.options.onError("Taille maiximun de fichier dépassé"),!1):this.options.allowedTypes.indexOf(b.type)<0?(c.options.onError("Type de fichier non reconnu"),!1):(d=new XMLHttpRequest,d.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100)+"%";c.options.onProgress(b)}},!1),d.open("post",this.options.uploadUrl,!0),d.onreadystatechange=function(a){if(4===d.readyState)if(c.isDroppable=!1,d.status>=200&&d.status<400){var b=$.parseJSON(a.target.responseText);b.hasOwnProperty("error")?b.error===!1?c.options.onDone(b,c):c.options.onFail(b,c):c.options.onLoad(b,c),c.isDroppable=!0,c.options.always(c)}else c.options.onError(d.status+" "+d.statusText,c),c.options.always(c)},d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-Type","multipart/form-data"),d.setRequestHeader("X-File-Name",b.name),d.setRequestHeader("X-File-Type",b.type),d.setRequestHeader("X-File-Size",b.size),void d.send(b)):(c.options.onError("Ce n'est pas un fichier"),!1)},a.prototype.initEvents=function(){this.$element.on({dragenter:this.onDragEnter,dragover:this.onDragOver,dragleave:this.onDragLeave,drop:this.onDrop})},a.DEFAULTS={hoverClass:"hover",dropClass:"dropped",uploadUrl:"",fileMaxSize:1e6,allowedTypes:["image/jpeg","image/gif","image/png"],onProgress:function(){},onDone:function(){},onDropped:function(){},onFail:function(){},onLoad:function(){},always:function(){},onError:function(){}},a}();!function(a){jQuery.event.props.push("dataTransfer"),a.fn.imgUpload=function(b){return this.each(function(){var c;a.data(this,"hasUpload")||(a.data(this,"hasUpload",!0),c=new ImageUpload(this,b))})}}(jQuery,this);