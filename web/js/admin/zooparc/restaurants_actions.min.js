var ImageUpload=function(){function a(b,c){this.element=b,this.options={},this.options=$.extend(!0,{},a.DEFAULTS,c||{}),this.$element=$(this.element),this.$element.data("uploader",this),this.isDroppable=!0,this.initEvents()}return a.prototype.onDragEnter=function(a){a.preventDefault()},a.prototype.onDragOver=function(a){a.preventDefault();var b=$(this).data("uploader");$(this).addClass(b.options.hoverClass)},a.prototype.onDragLeave=function(a){a.preventDefault();var b=$(this).data("uploader");$(this).removeClass(b.options.hoverClass)},a.prototype.onDrop=function(a){a.preventDefault();var b=$(this).data("uploader");$(this).removeClass(b.options.hoverClass),b.isDroppable&&(b.options.onDropped(b),b.isDroppable=!1,b.upload(a.dataTransfer.files))},a.prototype.upload=function(a){var b=a[0],c=this,d=null;return"size"in b?b.size>this.options.fileMaxSize?(c.options.onError("Taille maiximun de fichier dépassé"),!1):this.options.allowedTypes.indexOf(b.type)<0?(c.options.onError("Type de fichier non reconnu"),!1):(d=new XMLHttpRequest,d.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100)+"%";c.options.onProgress(b)}},!1),d.open("post",this.options.uploadUrl,!0),d.onreadystatechange=function(a){if(4===d.readyState)if(c.isDroppable=!1,d.status>=200&&d.status<400){var b=$.parseJSON(a.target.responseText);b.hasOwnProperty("error")?b.error===!1?c.options.onDone(b,c):c.options.onFail(b,c):c.options.onLoad(b,c),c.isDroppable=!0,c.options.always(c)}else c.options.onError(d.status+" "+d.statusText,c),c.options.always(c)},d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-Type","multipart/form-data"),d.setRequestHeader("X-File-Name",b.name),d.setRequestHeader("X-File-Type",b.type),d.setRequestHeader("X-File-Size",b.size),void d.send(b)):(c.options.onError("Ce n'est pas un fichier"),!1)},a.prototype.initEvents=function(){this.$element.on({dragenter:this.onDragEnter,dragover:this.onDragOver,dragleave:this.onDragLeave,drop:this.onDrop})},a.DEFAULTS={hoverClass:"hover",dropClass:"dropped",uploadUrl:"",fileMaxSize:1e6,allowedTypes:["image/jpeg","image/gif","image/png"],onProgress:function(){},onDone:function(){},onDropped:function(){},onFail:function(){},onLoad:function(){},always:function(){},onError:function(){}},a}();!function(a){jQuery.event.props.push("dataTransfer"),a.fn.imgUpload=function(b){return this.each(function(){var c;a.data(this,"hasUpload")||(a.data(this,"hasUpload",!0),c=new ImageUpload(this,b))})}}(jQuery,this);var NewRestaurantManager=function(){function a(b,c){this.$element=b,this.options={},this.options=$.extend(!0,{},a.DEFAULTS,c||{}),this.datas={name:"",description:"",num:null,image:"",thumb:""},this.saveBtn=$(this.options.saveBtnId,this.$element),this.nameIpt=$(this.options.nameId,this.$element),this.imageIpt=$(this.options.imageId,this.$element),this.thumbIpt=$(this.options.thumbId,this.$element),this.numIpt=$(this.options.numId,this.$element),this.descriptionIpt=$(this.options.descriptionId,this.$element),this.noImageAlert=$(this.options.noImageId,this.$element),this.imgHolder=$(this.options.imgHolder,this.$element),this.loader=this.saveBtn.next(".loader"),this.noImageAlert.text("Pas d'image uploadée."),this.initEvents()}return a.prototype.save=function(){var a=this;this.saveBtn.hide(),this.loader.show(),$.ajax({type:"POST",url:this.options.saveUrl,data:this.datas}).done(function(b){0==b.error?location.reload(!0):(a.options.showMsg(b.msg,!1),a.saveBtn.show(),a.loader.hide())}).fail(function(b){a.options.showMsg(b.statusCode+" "+b.statusText,!1),a.saveBtn.show(),a.loader.hide()})},a.prototype.addImage=function(a){this.imageIpt.val(a.image),this.datas.image=a.image,this.thumbIpt.val(a.thumb),this.datas.thumb=a.thumb,this.imgHolder.empty();var b=$("<img />",{src:this.datas.image});this.imgHolder.append(b)},a.prototype.getDatas=function(){return this.datas},a.prototype.testDatas=function(){return""==this.datas.name||""==this.datas.description||""==this.datas.image||""==this.datas.thumb||""==this.datas.num?!1:!0},a.prototype.fillDatas=function(){this.datas.name=this.nameIpt.val(),this.datas.description=this.descriptionIpt.val(),this.datas.image=this.imageIpt.val(),this.datas.num=this.numIpt.val(),this.datas.thumb=this.thumbIpt.val()},a.prototype.clearErrors=function(){var a=this.$element.find(".has-error").removeClass("has-error");a.removeClass("has-error"),this.noImageAlert.hide()},a.prototype.showErrors=function(){this.clearErrors(),""==this.datas.name&&this.nameIpt.parents(".form-group").addClass("has-error"),""==this.datas.num&&this.numIpt.parents(".form-group").addClass("has-error"),""==this.datas.description&&this.descriptionIpt.parents(".form-group").addClass("has-error"),""==this.datas.image&&this.noImageAlert.show()},a.prototype.initEvents=function(){var a=this;this.saveBtn.on("click",function(b){return b.preventDefault(),a.fillDatas(),a.testDatas()===!1?(a.showErrors(),!1):void a.save()})},a.DEFAULTS={saveUrl:"",saveBtnId:"",nameId:"",descriptionId:"",numId:"",imageId:"",noImageId:"",imgHolder:"",showMsg:function(){}},a}(),RestaurantManager=function(){function a(b,c,d){this.list=b,this.restos=c,this.options={},this.options=$.extend(!0,{},a.DEFAULTS,d||{}),this.imgBtns=$(this.options.imgBtn,this.list),this.imgs=$(this.options.restoImgClass,this.list),this.statusBtns=$(this.options.statusBtnClass),this.deleteBtns=$(this.options.deleteBtnClass),this.editBtns=$(this.options.editBtnClass),this.overlay=$("<div id='overlay'></div>"),this.updateBtn=$(this.options.updateBtnId),this.cancelUpdateBtn=$(this.options.cancelUpdateBtnId),$(document.body).append(this.overlay),this.initEvents()}return a.prototype.deleteResto=function(a){var b,c,d,e,f;b=this,c=a.next(this.options.loaderClass),c.show(),a.hide(),d=a.data("id"),e=a.parents("#"+this.options.rowRestoPrefix+d),f=e.next("#restaurant_edit_row_next_"+d),b.options.showMsg(),window.confirm(this.options.confirmText)&&$.ajax({url:this.options.deleteUrl,type:"DELETE",data:{id:d}}).done(function(d){0==d.error?(f.remove(),e.remove(),b.options.showMsg(d.msg,!0)):b.options.showMsg(d.msg,!1),c.hide(),a.show()}).fail(function(d){c.hide(),a.show(),b.options.showMsg(d.statusCode+" "+d.statusText,!1)})},a.prototype.editResto=function(a){var b,c,d,e;b=this,c=a.data("id"),d=$("#restaurant_edit"),e=this.findRestoById(c);var f=$("#js-edit-resto-name"),g=$("#js-edit-resto-num"),h=$("#js-edit-resto-description"),i=$("#js-edit-resto-image"),j=$("#js-edit-resto-thumb"),k=$("#resto-thumb");null!=e&&(k.attr("src",e.thumb),f.val(e.name),g.val(e.num),h.val(e.description),i.val(e.image),j.val(e.thumb),d.data("id",c),d.hasClass("js-is-close")?d.slideDown(500,function(){d.removeClass("js-is-close").addClass("js-is-open")}):d.slideUp(500,function(){d.removeClass("js-is-open").addClass("js-is-close")}))},a.prototype.updateResto=function(a){var b=this,c=a.next(".loader"),d=$("#js-edit-resto-name"),e=$("#js-edit-resto-num"),f=$("#js-edit-resto-description"),g=$("#js-edit-resto-image"),h=$("#js-edit-resto-thumb"),i=($("#resto-thumb"),$("#restaurant_edit")),j={id:i.data("id"),name:d.val(),num:e.val(),description:f.val(),image:g.val(),thumb:h.val()};a.hide(),c.show(),$.ajax({type:"PUT",url:this.options.updateRestoUrl,data:j}).done(function(d){0==d.error?location.reload(!0):(a.show(),c.hide(),b.options.showMsg(d.msg,!1))}).fail(function(d){a.show(),c.hide(),b.options.showMsg(d.statusCode+" "+d.statusText,!1)})},a.prototype.updateImg=function(a){var b=$("#js-edit-resto-image"),c=$("#js-edit-resto-thumb"),d=$("#resto-thumb");b.val(a.image),c.val(a.thumb),d.attr("src",a.thumb)},a.prototype.cancelUpdate=function(){var a=$("#js-edit-resto-name"),b=$("#js-edit-resto-num"),c=$("#js-edit-resto-description"),d=$("#resto-thumb"),e=$("#js-edit-resto-image"),f=$("#js-edit-resto-thumb"),g=$("#restaurant_edit");d.attr("src",""),a.val(""),b.val(""),c.val(""),e.val(""),f.val(""),g.slideUp(500,function(){g.removeClass("js-is-open").addClass("js-is-close")})},a.prototype.findRestoById=function(a){var b=null;return $.each(this.restos,function(c,d){d.id==a&&(b=d)}),b},a.prototype.changeStatus=function(a){var b,c,d,e,f;b=this,c=a.next(this.options.loaderClass),c.show(),a.hide(),d=a.data("id"),e=a.parents("#"+this.options.rowRestoPrefix+d),f=e.find(this.options.statusTextClass),b.options.showMsg(),$.ajax({url:this.options.changeStatusUrl,type:"POST",data:{id:d}}).done(function(d){if(0==d.error){var e=1==d.datas.isOpen?b.options.openText:b.options.closeText;f.text(e),b.options.showMsg(d.msg,!0)}else b.options.showMsg(d.msg,!1);c.hide(),a.show()}).fail(function(d){c.hide(),a.show(),b.options.showMsg(d.statusCode+" "+d.statusText,!1)})},a.prototype.initEvents=function(){var a=this;this.imgBtns.on("click",function(b){b.preventDefault(),a.overlay.addClass("active");var c=$(this).next(".js-resto-img");c.addClass("active")}),this.overlay.on("click",function(b){b.preventDefault(),a.imgs.removeClass("active"),$(this).removeClass("active")}),this.statusBtns.on("click",function(b){b.preventDefault(),a.changeStatus($(this))}),this.deleteBtns.on("click",function(b){b.preventDefault(),a.deleteResto($(this))}),this.editBtns.on("click",function(b){b.preventDefault(),a.editResto($(this))}),this.updateBtn.on("click",function(b){b.preventDefault(),a.updateResto($(this))}),this.cancelUpdateBtn.on("click",function(b){b.preventDefault(),a.cancelUpdate($(this))})},a.DEFAULTS={imgBtn:"",restoImgClass:"",changeStatusUrl:"",updateRestoUrl:"",rowRestoPrefix:"",statusBtnClass:".js-status-btn",statusTextClass:"",deleteBtnClass:"",editBtnClass:"",loaderClass:".loader",openText:"",closeText:"",deleteUrl:"",updateBtnId:"",cancelUpdateBtnId:"",confirmText:"Attention cette action est irréversible. Vous confirmez ?",showMsg:function(){}},a}();